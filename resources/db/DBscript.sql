DROP TABLE POWERUSER.COMMENT;
DROP TABLE POWERUSER.BUILD;
DROP TABLE POWERUSER.ISSUE;
DROP TABLE POWERUSER.PROJECT;
DROP TABLE POWERUSER.STATUS;
DROP TABLE POWERUSER.RESOLUTION;
DROP TABLE POWERUSER.USER_;

CREATE TABLE POWERUSER.STATUS
(
    ID INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    STATUS_NAME VARCHAR(255) NOT NULL,
    PRIMARY KEY (ID)
);

INSERT INTO POWERUSER.STATUS (STATUS_NAME) VALUES
('New'),
('Assigned'),
('In Progress'),
('Resolved'),
('Closed'),
('Reopened');

CREATE TABLE POWERUSER.RESOLUTION
(
    ID INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    RESOLUTION_NAME VARCHAR(255) NOT NULL,
    PRIMARY KEY (id)
);

INSERT INTO POWERUSER.RESOLUTION (RESOLUTION_NAME) VALUES
('Fixed'),
('Invalid'),
('Wontfix'),
('Worksforme');

CREATE TABLE POWERUSER.USER_
(
	ID INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
	FIRST_NAME VARCHAR(255) NOT NULL,
	LAST_NAME VARCHAR(255) NOT NULL,
	PASSWORD VARCHAR(255) NOT NULL,	
	EMAIL VARCHAR(255) NOT NULL,
	ROLE VARCHAR(255) NOT NULL,
	PRIMARY KEY (ID)
);

/* password 8b04d5e3775d298e78455efc5ca404d5 == first */
INSERT INTO POWERUSER.USER_ (FIRST_NAME, LAST_NAME, PASSWORD, EMAIL, ROLE) VALUES
('Vladimir', 'Chesnokov', '8b04d5e3775d298e78455efc5ca404d5', 'vladimir@site.com', 'USER'),
('Ilya', 'Glazunov', '8b04d5e3775d298e78455efc5ca404d5', 'ilya@site.com', 'ADMINISTRATOR'),
('Petr', 'Timoshenko', '8b04d5e3775d298e78455efc5ca404d5', 'petr@site.com', 'USER');

CREATE TABLE POWERUSER.ISSUE
(
	ID INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    DATE_CREATION TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    USER_CREATION_ID INTEGER NOT NULL,
    DATE_MODIFY TIMESTAMP,
    USER_MODIFY_ID INTEGER,
    SUMMARY VARCHAR(225) NOT NULL,
    DESCRIPTION VARCHAR(500) NOT NULL,
    STATUS_ID INTEGER NOT NULL,
    RESOLUTION_ID INTEGER,
    TYPE_ID INTEGER NOT NULL,
    PRIORITY_ID INTEGER NOT NULL,
    PROJECT_ID INTEGER NOT NULL,
    BUILD_ID INTEGER NOT NULL,
    ASSIGNEE_ID INTEGER,
   	PRIMARY KEY (ID),
    FOREIGN KEY (USER_CREATION_ID) REFERENCES POWERUSER.USER_(ID),
    FOREIGN KEY (USER_MODIFY_ID) REFERENCES POWERUSER.USER_(ID),
    FOREIGN KEY (STATUS_ID) REFERENCES POWERUSER.STATUS(ID),
    FOREIGN KEY (RESOLUTION_ID) REFERENCES POWERUSER.RESOLUTION(ID),    
    FOREIGN KEY (ASSIGNEE_ID) REFERENCES POWERUSER.USER_(ID)
);

INSERT INTO POWERUSER.ISSUE (DATE_CREATION, USER_CREATION_ID, DATE_MODIFY, USER_MODIFY_ID, SUMMARY, DESCRIPTION, STATUS_ID, RESOLUTION_ID, TYPE_ID, PRIORITY_ID, PROJECT_ID, BUILD_ID, ASSIGNEE_ID) VALUES
('2014-05-10 01:00:00.000', 1, '2014-05-19 14:20:24.657', 2, 'summary, issue 1', 'description - issue 1', 1, null, 1, 1, 1, 1, null),
('2014-05-10 02:00:00.000', 1, '2014-05-20 14:20:24.657', 2, 'summary, issue 2', 'description - issue 2', 1, null, 1, 1, 1, 1, null),
('2014-05-10 03:00:00.000', 1, '2014-05-21 14:20:24.657', 2, 'summary, issue 3', 'description - issue 3', 2, null, 1, 1, 1, 1, 1),
('2014-05-11 04:00:00.000', 1, '2014-05-22 14:20:24.657', 2, 'summary, issue 4', 'description - issue 4', 3, null, 1, 1, 1, 1, 2),
('2014-05-12 05:00:00.000', 1, '2014-05-23 14:20:24.657', 2, 'summary, issue 5', 'description - issue 5', 4, 1, 1, 1, 1, 1, 3),
('2014-05-13 06:00:00.000', 1, '2014-05-15 14:20:24.657', 2, 'summary, issue 6', 'description - issue 6', 1, null, 1, 1, 1, 1, null),
('2014-05-14 07:00:00.000', 1, '2014-05-16 14:20:24.657', 2, 'summary, issue 7', 'description - issue 7', 1, null, 1, 1, 1, 1, null),
('2014-05-15 08:00:00.000', 1, '2014-05-17 14:20:24.657', 2, 'summary, issue 8', 'description - issue 8', 1, null, 1, 1, 1, 1, null),
('2014-05-16 09:00:00.000', 1, '2014-05-18 14:20:24.657', 2, 'summary, issue 9', 'description - issue 9', 1, null, 1, 1, 1, 1, null),
('2014-05-16 10:00:00.000', 1, '2014-05-24 14:20:24.657', 2, 'summary, issue 10', 'description - issue 10', 1, null, 1, 1, 1, 1, null),
('2014-05-17 11:00:00.000', 1, '2014-05-25 14:20:24.657', 2, 'summary, issue 11', 'description - issue 11', 1, null, 1, 1, 1, 1, null),
('2014-05-18 12:00:00.000', 1, '2014-05-26 14:20:24.657', 2, 'summary, issue 12', 'description - issue 12', 1, null, 1, 1, 1, 1, null);

CREATE TABLE POWERUSER.COMMENT
(
    ID INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    TEXT VARCHAR(255) NOT NULL,
    USER_ID INTEGER NOT NULL,
    CREATE_DATE TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    ISSUE_ID INTEGER NOT NULL,
    PRIMARY KEY (ID),
    FOREIGN KEY (USER_ID) REFERENCES POWERUSER.USER_(ID),
    FOREIGN KEY (ISSUE_ID) REFERENCES POWERUSER.ISSUE(ID)
);

INSERT INTO POWERUSER.COMMENT (TEXT, USER_ID, CREATE_DATE, ISSUE_ID) VALUES
('comment 1', 1, '2014-05-15 08:00:00.000', 1),
('comment 2', 2, '2014-05-15 08:00:00.000', 1),
('comment 3', 3, '2014-05-15 08:00:00.000', 1),
('comment 4', 1, '2014-05-15 08:00:00.000', 2),
('comment 5', 2, '2014-05-15 08:00:00.000', 2),
('comment 6', 3, '2014-05-15 08:00:00.000', 2),
('comment 7', 1, '2014-05-15 08:00:00.000', 3),
('comment 8', 2, '2014-05-15 08:00:00.000', 3),
('comment 9', 3, '2014-05-15 08:00:00.000', 3),
('comment 10', 1, '2014-05-15 08:00:00.000', 4),
('comment 11', 2, '2014-05-15 08:00:00.000', 4),
('comment 12', 3, '2014-05-15 08:00:00.000', 4),
('comment 13', 1, '2014-05-15 08:00:00.000', 5),
('comment 14', 2, '2014-05-15 08:00:00.000', 5),
('comment 15', 3, '2014-05-15 08:00:00.000', 5);

CREATE TABLE POWERUSER.PROJECT
(
    ID INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    PROJECT_NAME VARCHAR(255) NOT NULL,
    DESCRIPTION VARCHAR(225) NOT NULL,
    MANAGER_ID INTEGER NOT NULL,
    PRIMARY KEY (ID),
    FOREIGN KEY (MANAGER_ID) REFERENCES POWERUSER.USER_(ID)
);

INSERT INTO POWERUSER.PROJECT (PROJECT_NAME, DESCRIPTION, MANAGER_ID) VALUES
('First Project', 'This is description for the first project', 1),
('Second project', 'Test description for the second project', 1),
('Third Project', 'This is description for the third project', 1),
('Fourth Project', 'This is description for the fourth project', 1),
('Fifth Project', 'This is description for the fifth project', 2);

CREATE TABLE POWERUSER.BUILD
(
    ID INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    BUILD_NAME VARCHAR(255) NOT NULL,
    PROJECT_ID INTEGER NOT NULL,
    PRIMARY KEY (ID),
    FOREIGN KEY (PROJECT_ID) REFERENCES POWERUSER.PROJECT(ID)
);

INSERT INTO POWERUSER.BUILD (BUILD_NAME, PROJECT_ID) VALUES
('1.0', 1),
('1.0', 2),
('1.0', 3),
('1.0', 4),
('1.0', 5),
('1.1', 5);